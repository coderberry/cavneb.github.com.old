
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Airbrake exception logging in your Grails application - coderberry.me</title>
    <meta name="author" content="Eric Berry">

    
    <meta name="description" content="Airbrake Exception Logging in Your Grails Application Recently I worked on migrating the Airbrake plugin written by Phuong LeCong to Grails version &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="/atom.xml" rel="alternate" title="coderberry.me" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26417518-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<header class="inner"><h1 class="left"><a href="/">coderberry.me</a></h1>
<nav class="menu left"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:coderberry.me">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/cavneb" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/cavneb" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/cavneb">cavneb</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('cavneb', 4, false);
	})(jQuery);
</script>

	<div id="content" class="inner"><article class="post">
    <h1 class="title">Airbrake Exception Logging in Your Grails Application</h1>
    <div class="entry"><p>Recently I worked on migrating the Airbrake plugin written by <a href="https://github.com/plecong/grails-airbrake">Phuong LeCong</a> to Grails version 2.1 (<a href="https://github.com/cavneb/airbrake-grails">repo here</a>). After completing the plugin, I attempted to submit it to the Grails plugin repo via the <a href="http://grails.1312388.n4.nabble.com/Permission-to-publish-plugin-td4634449.html">developer mailing list</a>.</p>

<p><a href="[@bostanio](http://twitter.com/bostanio">Jon Palmer</a>) brought to my attention that there is a Java library that is being used to accomplish this task. I had searched prior for a solution that would work with Grails, but I didn&#8217;t find any solid instructions on how to integrate the Java Airbrake library into my Grails apps.</p>

<p>So here it is.</p>

<h3>Installation</h3>

<p>The Airbrake Java library exists in the Maven repo (<a href="http://mvnrepository.com/artifact/io.airbrake/airbrake-java/2.2.0">http://mvnrepository.com/artifact/io.airbrake/airbrake-java/2.2.0</a>) and can be installed by simple adding the following as a runtime dependency in your <code>BuildConfig.groovy</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dependencies {
</span><span class='line'>    runtime 'io.airbrake:airbrake-java:2.2.0'
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Next time your app compiles, the Airbrake library should be installed and ready to go.</p>

<h3>Integration</h3>

<p>It&#8217;s nearly as simple to integrate the Airbrake exception notification process into your Grails application. This is done by adding a log4j appender into your <code>Config.groovy</code> file. Make sure that you update the appender config with the correct project API key from Airbrake.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log4j = {
</span><span class='line'>  // Example of changing the log pattern for the default console appender:
</span><span class='line'>  appenders {
</span><span class='line'>    appender new airbrake.AirbrakeAppender (
</span><span class='line'>      name: 'airbrake', 
</span><span class='line'>      api_key: 'API_KEY', // replace with your Airbrake API key
</span><span class='line'>      env: ((Environment.current == Environment.PRODUCTION)  ? 'production' : 'development'),
</span><span class='line'>      enabled: true
</span><span class='line'>    )
</span><span class='line'>    ...</span></code></pre></td></tr></table></div></figure>


<p>After the appender is in place, you need to let your Grails app know to use it as a global appender. Add <code>'airbrake'</code> to your root <code>debug</code> node:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log4j = {
</span><span class='line'>  // Example of changing the log pattern for the default console appender:
</span><span class='line'>  appenders {
</span><span class='line'>    appender new airbrake.AirbrakeAppender (
</span><span class='line'>      name: 'airbrake', 
</span><span class='line'>      api_key: 'API_KEY', // replace with your Airbrake API key
</span><span class='line'>      env: ((Environment.current == Environment.PRODUCTION)  ? 'production' : 'development'),
</span><span class='line'>      enabled: true
</span><span class='line'>    )
</span><span class='line'>    ...
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  root {
</span><span class='line'>    debug 'stdout', 'airbrake' // This can be added to any log level, not only 'debug'
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Once this is all in place, you should be able to test it out.</p>

<h3>Testing</h3>

<p>To test the Airbrake exception notification, an exception must be thrown in your application when running. A good way to do this (although not ideal) is to create a controller with an action that throws an exception. I added this action to an existing controller, which again isn&#8217;t ideal.</p>

<p>Here&#8217;s an example controller and action:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class AirbrakeTestController {
</span><span class='line'>
</span><span class='line'>  def simulateError() {
</span><span class='line'>    session.myval = "Something in the Session!"
</span><span class='line'>    throw new Exception("TestException ${System.currentTimeMillis()}")
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Once this is created, run your application and visit <a href="http://localhost:8080/airbrakeTest/simulateError">http://localhost:8080/airbrakeTest/simulateError</a>. You should see a page similar to this:</p>

<div style="padding: 20px; 
      background: white; 
      margin-top: 10px;
      -webkit-border-radius: 5px;
      -moz-border-radius: 5px;
      border-radius: 5px;">
  <img src="/images/posts/airbrake-grails-exception.png" style="display: block;"/>
  <em>As you can see, I placed the action in another controller</em>
</div>


<p>Now log into Airbrake.io and you should see your exception listed.</p>

<div style="padding: 20px; 
      background: #DADADA; 
      margin-top: 10px;
      -webkit-border-radius: 5px;
      -moz-border-radius: 5px;
      border-radius: 5px;">
  <img src="/images/posts/airbrake-airbrake-exception-list.png" style="display: block;"/>
  <img src="/images/posts/airbrake-airbrake-exception.png" style="display: block;"/>
</div>


<p>The data provided in the backtrace is a little weak and unformatted, and you can&#8217;t see anywhere the contents of the session. It does however notify you when an exception is thrown and performs the goodness that Airbrake provides.</p>

<h3>Afterthoughts</h3>

<p>The plugin I had submitted to the Grails plugin repository added a few extra goodies to the Airbrake notifications, primarily enhanced backtraces and session/request data. This isn&#8217;t available in the Airbrake java library mentioned above.</p>

<p>After submitting the request to the mailing list, I received a couple of questions to the validity of the plugin, and then&#8230; nothing. I replied with reasons it&#8217;s worth it, but there was no acceptance in place. I guess I could have pushed it to brute force my plugin into the repository, but to what end? I have a strong background with <a href="http://coderberry.me/blog/categories/ruby/">Ruby</a> and <a href="http://shop.oreilly.com/product/9780596520717.do">Rails</a>, and am an active member of the <a href="http://utruby.org/">Ruby community</a>. Not once have I felt that my contribution to their community has been rejected. I can&#8217;t help but feel this from my experience with the Grails community.</p>

<p>That being said, I have worked with some of the core developers of Grails and they share my concerns. They have very little to do with it, and have little control to change things. The new changes at <a href="http://beta.grails.org/plugins">http://beta.grails.org</a> should promote more interaction in regards to plugins, but who knows.</p>

<p>Here are my parting words:</p>

<p><strong>Don&#8217;t take the time to write a plugin which is intended for public use until AFTER you get it approved from the Grails developer mailing list.</strong></p>
</div>
    <div class="meta">
        <div class="date">








  


<time datetime="2012-09-11T14:34:00-06:00" pubdate data-updated="true">Sep 11<span>th</span>, 2012</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/blog/categories/grails/'>Grails</a>
  
</div>

</div>
        
        <span class="comments"><a href="#disqus_thread">Comments</a></span>
        
    </div>
</article>
<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer class="inner">Copyright &copy; 2012 coderberry.me</footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'coderberry';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://coderberry.me/blog/2012/09/11/airbrake-exception-logging-in-your-grails-application/';
        var disqus_url = 'http://coderberry.me/blog/2012/09/11/airbrake-exception-logging-in-your-grails-application/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>