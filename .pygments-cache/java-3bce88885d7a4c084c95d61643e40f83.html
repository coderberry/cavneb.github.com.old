<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span>

<span class="cm">/**</span>
<span class="cm"> * Generated by the Shiro plugin. This filters class protects all URLs</span>
<span class="cm"> * via access control by convention.</span>
<span class="cm"> */</span>
<span class="kd">class</span> <span class="nc">SecurityFilters</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Array of controller/action combinations which will be skipped from authentication</span>
<span class="cm">     * if the controller and action names match. The action value can also be &#39;*&#39; if it</span>
<span class="cm">     * encompasses all actions within the controller.</span>
<span class="cm">     */</span>
    <span class="kd">static</span> <span class="n">nonAuthenticatedActions</span> <span class="o">=</span> <span class="o">[</span>
            <span class="o">[</span><span class="nl">controller:</span> <span class="err">&#39;</span><span class="n">home</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">action:</span> <span class="err">&#39;</span><span class="n">index</span><span class="err">&#39;</span><span class="o">]</span>
    <span class="o">]</span>

    <span class="cm">/**</span>
<span class="cm">     * Array of controller/action combinations that will be authenticated against the user&#39;s</span>
<span class="cm">     * role. The map also includes the roles which the controller/action pair will match</span>
<span class="cm">     * against.</span>
<span class="cm">     */</span>
    <span class="kd">static</span> <span class="n">authenticatedActions</span> <span class="o">=</span> <span class="o">[</span>
            <span class="o">[</span><span class="nl">controller:</span> <span class="err">&#39;</span><span class="n">home</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">action:</span> <span class="err">&#39;</span><span class="n">secured</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">roles:</span> <span class="o">[</span><span class="err">&#39;</span><span class="n">ROLE_ADMIN</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">ROLE_USER</span><span class="err">&#39;</span><span class="o">]],</span>
            <span class="o">[</span><span class="nl">controller:</span> <span class="err">&#39;</span><span class="n">home</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">action:</span> <span class="err">&#39;</span><span class="n">admin</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">roles:</span> <span class="o">[</span><span class="err">&#39;</span><span class="n">ROLE_ADMIN</span><span class="err">&#39;</span><span class="o">]]</span>
    <span class="o">]</span>

    <span class="n">def</span> <span class="n">filters</span> <span class="o">=</span> <span class="o">{</span>

        <span class="n">all</span><span class="o">(</span><span class="nl">controller:</span> <span class="sc">&#39;*&#39;</span><span class="o">,</span> <span class="nl">action:</span> <span class="sc">&#39;*&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">before</span> <span class="o">=</span> <span class="o">{</span>

                <span class="c1">// Determine if the controller/action belongs is not to be authenticated</span>
                <span class="n">def</span> <span class="n">needsAuth</span> <span class="o">=</span> <span class="o">!</span><span class="n">nonAuthenticatedActions</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span>
                    <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">controller</span> <span class="o">==</span> <span class="n">controllerName</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                            <span class="o">((</span><span class="n">it</span><span class="o">.</span><span class="na">action</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">action</span> <span class="o">==</span> <span class="n">actionName</span><span class="o">))</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">needsAuth</span><span class="o">)</span> <span class="o">{</span>

                    <span class="c1">// Get the map within the authenticated actions which pertain to the current</span>
                    <span class="c1">// controller and view.</span>
                    <span class="n">def</span> <span class="n">authRoles</span> <span class="o">=</span> <span class="n">authenticatedActions</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span>
                        <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">controller</span> <span class="o">==</span> <span class="n">controllerName</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                                <span class="o">((</span><span class="n">it</span><span class="o">.</span><span class="na">action</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">action</span> <span class="o">==</span> <span class="n">actionName</span><span class="o">))</span>
                    <span class="o">}</span>

                    <span class="k">if</span> <span class="o">(</span><span class="n">authRoles</span><span class="o">)</span> <span class="o">{</span>

                        <span class="c1">// Perform the access control for each of the roles provided in the authRoles</span>
                        <span class="n">accessControl</span> <span class="o">{</span>
                            <span class="n">authRoles</span><span class="o">.</span><span class="na">roles</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">roleName</span> <span class="o">-&gt;</span>
                                <span class="n">role</span><span class="o">(</span><span class="n">roleName</span><span class="o">)</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span>

                    <span class="c1">// Skip authentication if the authRoles was not found</span>
                    <span class="k">else</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="kc">true</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="c1">// Skip authentication if no auth is needed</span>
                <span class="k">else</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="kc">true</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre>
</div>
